#!/bin/bash

set -eu

GIT_ROOT="$(git rev-parse --show-toplevel)"
cd "$GIT_ROOT"

image_tag_prefix="${IMAGE_TAG_PREFIX:-ryanprior/cdemo}"
version="$(cat VERSION)"

function announce {
  echo "$0: $@"
}

function tag_version {
  tag="$1"
  docker tag "$tag:latest" "$tag:$version"
}

announce Jenkins
export JENKINS_IMAGE_TAG="$image_tag_prefix-jenkins"
conjurDemo/roles/jenkinsConfig/files/jenkins/bin/build
tag_version $JENKINS_IMAGE_TAG

